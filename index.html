
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload File lÃªn GitHub</title>
</head>
<body>
    <div style="max-width: 600px; margin: 50px auto; padding: 20px;">
        <h1>ğŸ“¤ Upload File lÃªn GitHub</h1>
        <p><strong>Repo:</strong> Datkep92/aquyet</p>
        <p><strong>Path:</strong> docs/Quyet/</p>
        
        <form id="uploadForm" style="margin-top: 20px;">
            <div style="margin-bottom: 15px;">
                <label><strong>TÃªn TÃ¡c Giáº£:</strong></label><br>
                <input type="text" id="authorName" placeholder="Nháº­p tÃªn tÃ¡c giáº£" required 
                       style="width: 100%; padding: 8px; margin-top: 5px;">
            </div>

            <div style="margin-bottom: 15px;">
                <label><strong>TiÃªu Äá» SÃ¡ch:</strong></label><br>
                <input type="text" id="bookTitle" placeholder="Nháº­p tiÃªu Ä‘á» sÃ¡ch" required 
                       style="width: 100%; padding: 8px; margin-top: 5px;">
            </div>

            <div style="margin-bottom: 15px;">
                <label><strong>GitHub Token:</strong></label><br>
                <input type="text" id="githubToken" placeholder="Nháº­p GitHub Token" required 
                       style="width: 100%; padding: 8px; margin-top: 5px;">
            </div>

            <div style="margin-bottom: 15px;">
                <label><strong>Chá»n File HTML:</strong></label><br>
                <input type="file" id="fileInput" accept=".html,.htm" required 
                       style="margin-top: 5px;">
                <div id="fileName" style="margin-top: 5px; color: #666;"></div>
            </div>

            <button type="submit" id="uploadBtn" 
                    style="width: 100%; padding: 12px; background: #28a745; color: white; border: none; cursor: pointer;">
                ğŸš€ Upload lÃªn GitHub
            </button>
        </form>

        <div id="loading" style="display: none; text-align: center; margin: 20px 0;">
            <p>ğŸ”„ Äang upload file lÃªn GitHub...</p>
        </div>

        <div id="successResult" style="display: none; background: #d4edda; color: #155724; padding: 15px; margin-top: 20px;">
            <h3>âœ… Upload ThÃ nh CÃ´ng!</h3>
            <p id="successMessage"></p>
            <p><strong>ğŸ“ Link:</strong> <a id="fileLink" target="_blank"></a></p>
        </div>

        <div id="errorResult" style="display: none; background: #f8d7da; color: #721c24; padding: 15px; margin-top: 20px;">
            <h3>âŒ Lá»—i Upload</h3>
            <p id="errorMessage"></p>
        </div>
    </div>

    <script>
        class GitHubUploader {
            constructor() {
                this.initializeElements();
                this.bindEvents();
            }

            initializeElements() {
                this.form = document.getElementById('uploadForm');
                this.fileInput = document.getElementById('fileInput');
                this.fileName = document.getElementById('fileName');
                this.authorName = document.getElementById('authorName');
                this.bookTitle = document.getElementById('bookTitle');
                this.githubToken = document.getElementById('githubToken');
                this.uploadBtn = document.getElementById('uploadBtn');
                this.loading = document.getElementById('loading');
                this.successResult = document.getElementById('successResult');
                this.errorResult = document.getElementById('errorResult');
                this.successMessage = document.getElementById('successMessage');
                this.errorMessage = document.getElementById('errorMessage');
                this.fileLink = document.getElementById('fileLink');
            }

            bindEvents() {
                this.form.addEventListener('submit', (e) => this.handleSubmit(e));
                this.fileInput.addEventListener('change', (e) => this.handleFileSelect(e));
            }

            handleFileSelect(e) {
                const file = e.target.files[0];
                if (file) {
                    this.fileName.textContent = `ğŸ“„ File: ${file.name}`;
                }
            }

            async handleSubmit(e) {
                e.preventDefault();
                
                const file = this.fileInput.files[0];
                const author = this.authorName.value.trim();
                const title = this.bookTitle.value.trim();
                const token = this.githubToken.value.trim();

                if (!file || !author || !title || !token) {
                    this.showError('Vui lÃ²ng Ä‘iá»n Ä‘áº§y Ä‘á»§ thÃ´ng tin!');
                    return;
                }

                this.showLoading();

                try {
                    const result = await this.uploadToGitHub(file, author, title, token);
                    this.showSuccess(result);
                } catch (error) {
                    this.showError(error.message);
                }
            }

            async uploadToGitHub(file, author, title, token) {
                // Táº¡o folder name tá»« author
                const folderName = author.replace(/[^a-zA-Z0-9]/g, '_');
                const fileName = title.replace(/[^a-zA-Z0-9]/g, '_') + '.html';
                const filePath = `docs/Quyet/${folderName}/${fileName}`;

                // Äá»c file content
                const content = await this.readFileAsText(file);
                
                // Äáº£m báº£o encoding UTF-8
                const contentWithMeta = content.includes('<meta charset=') ? 
                    content : 
                    content.replace('<head>', '<head>\n    <meta charset="UTF-8">');

                // Upload lÃªn GitHub
                const apiUrl = `https://api.github.com/repos/Datkep92/aquyet/contents/${filePath}`;
                
                const payload = {
                    message: `Add: ${title} by ${author}`,
                    content: btoa(unescape(encodeURIComponent(contentWithMeta))),
                    branch: 'main'
                };

                const response = await fetch(apiUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP ${response.status}`);
                }

                const result = await response.json();
                return {
                    html_url: result.content.html_url,
                    download_url: result.content.download_url,
                    path: result.content.path
                };
            }

            readFileAsText(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = e => resolve(e.target.result);
                    reader.onerror = reject;
                    reader.readAsText(file, 'UTF-8');
                });
            }

            showLoading() {
                this.loading.style.display = 'block';
                this.successResult.style.display = 'none';
                this.errorResult.style.display = 'none';
                this.uploadBtn.disabled = true;
            }

            hideLoading() {
                this.loading.style.display = 'none';
                this.uploadBtn.disabled = false;
            }

            showSuccess(result) {
                this.hideLoading();
                this.successMessage.textContent = `ÄÃ£ upload "${this.bookTitle.value}" thÃ nh cÃ´ng!`;
                this.fileLink.href = result.html_url;
                this.fileLink.textContent = result.html_url;
                this.successResult.style.display = 'block';
                this.errorResult.style.display = 'none';
                
                // Reset form
                this.form.reset();
                this.fileName.textContent = '';
            }

            showError(message) {
                this.hideLoading();
                this.errorMessage.textContent = message;
                this.errorResult.style.display = 'block';
                this.successResult.style.display = 'none';
            }
        }

        // Khá»Ÿi táº¡o á»©ng dá»¥ng khi DOM loaded
        document.addEventListener('DOMContentLoaded', () => {
            new GitHubUploader();
        });
    </script>
</body>
</html>
